{
  "variables": {
    "source_ami": "ami-b7c8d5de",
    "kernel_release": "wheezy",
    "kernel_version": "amd64"
  },
  "builders": [{
    "type": "amazon-ebs",
    "region": "us-east-1",
    "source_ami": "{{user `source_ami`}}",
    "instance_type": "m3.medium",
    "ssh_username": "admin",
    "ssh_timeout": "5m",
    "ami_name": "mojo_debian_{{user `kernel_version`}}_{{timestamp}}",
    "ami_description": "source_ami: {{user `source_ami`}}"
  }],
  "provisioners": [{
    "type": "file",
    "source": "shared/files",
    "destination": "/tmp/files"
  },{
  "type": "shell",
  "environment_vars": [
    "DEBIAN_FRONTEND=noninteractive",
    "KERNEL_RELEASE={{user `kernel_release`}}",
    "KERNEL_VERSION={{user `kernel_version`}}"
  ],
  "execute_command": "{{.Vars}} sudo -E bash '{{.Path}}'",
  "scripts": [
    "shared/scripts/setup_apt.sh",
    "shared/scripts/setup.sh",
    "shared/scripts/update_kernel.sh",
    "shared/scripts/update_init.sh"
  ]}]
}
